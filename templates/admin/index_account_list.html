{% extends "template_index.html" %}

{% block css %}
{% include mode_css.html%}
<!-- JQuery DataTable Css -->
<link rel="stylesheet" href="{{ static_url('assets/plugins/jquery-datatable/dataTables.bootstrap4.min.css')}}">
<link rel="stylesheet" href="{{ static_url('assets/plugins/bootstrap-tagsinput/bootstrap-tagsinput.css')}}">
<link rel="stylesheet" href="{{ static_url('assets/plugins/sweetalert/sweetalert2.min.css')}}">
<!--<link rel="stylesheet" href="{{ static_url('assets/plugins/nouislider/nouislider.min.css')}}">-->
{% end %}

{% block middle %}
<section class="content" style="height: calc(100vh - 60px);">
    {% include mode_account_list.html%}

    <!--<div class="col-lg-6 col-md-12 col-sm-12">-->
    <!--<div class="card">-->
        <!--<div class="header">-->
            <!--<h2><strong>跟单参数</strong> 设置(<span id="accout_id"></span> )</h2>-->
        <!--</div>-->
        <!--<div class="body">-->
            <!--<form>-->
                <!--&lt;!&ndash;<label>最大延时</label>&ndash;&gt;-->
                <!--<div class="form-group">-->
                    <!--<div class="row clearfix">-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">最大延时</div>-->
                                <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 取值: 1-60 (S)</small></div>-->
                            <!--</div>-->
                            <!--<div class="form-group form-float">-->
                                <!--<input type="text" id="maxtime" class="form-control money-dollar" required>-->
                                <!--&lt;!&ndash;<div class="help-info text-right"><small>Min. Value: 10, Max. Value: 200</small></div>&ndash;&gt;-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">允许滑点</div>-->
                                <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 取值: 1-10 </small></div>-->
                            <!--</div>-->
                            <!--<div class="form-group">-->
                                <!--<input type="text" id="maxloss" class="form-control">-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<div class="row clearfix">-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">最大单量</div>-->
                                <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 取值: 1-50 </small></div>-->
                            <!--</div>-->
                            <!--<div class="form-group">-->
                                <!--<input type="text" id="maxnum" class="form-control">-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex checkbox" style="padding: 43px 21px 0px;">-->
                                <!--<input id="reflex" type="checkbox">-->
                                <!--<label for="reflex">反向跟单</label>-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<div class="row clearfix">-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">固定手数开单</div>-->
                                <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 取值: 0.01-100 </small></div>-->
                            <!--</div>-->
                            <!--<div class="form-group">-->
                                <!--<input type="text" id="fixed" class="form-control">-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">倍数开单</div>-->
                                <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 取值: 0.001-500 </small></div>-->
                            <!--</div>-->
                            <!--<div class="form-group">-->
                                <!--<input type="text" id="percent" class="form-control">-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->

                <!--<div class="form-group">-->
                    <!--<div class="row clearfix">-->
                        <!--<div class="col-lg-6 col-md-6">-->
                             <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">最小手数</div>-->
                                 <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 高优先级 </small></div>-->
                             <!--</div>-->
                            <!--<input type="text" id="rate_min" class="form-control">-->
                        <!--</div>-->
                        <!--<div class="col-lg-6 col-md-6">-->
                            <!--<div class="d-flex bd-highlight">-->
                                <!--<div class="mr-auto p-2 bd-highlight">最大手数</div>-->
                                <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 高优先级 </small> </div>-->
                            <!--</div>-->
                            <!--<input type="text" id="rate_max" class="form-control">-->
                        <!--</div>-->
                    <!--</div>-->
                <!--</div>-->
                <!--<div id="nouislider_range_example"></div>-->
                <!--&lt;!&ndash;<div class="m-t-20 font-12 m-3"><b>(控制开单手数范围): </b><span class="js-nouislider-value"></span></div>&ndash;&gt;-->
                <!--<div class="d-flex bd-highlight" style="padding: 21px 0px 0px;">-->
                    <!--<div class="mr-auto p-2 bd-highlight">风控线</div>-->
                    <!--<div class="p-2 bd-highlight"><small><i class="zmdi zmdi-help-outline"></i> 低于填写的金额,则邮件报警 </small></div>-->
                <!--</div>-->
                <!--<div class="form-group">-->
                    <!--<input type="text" id="Wind_control_line" class="form-control" placeholder="Enter your password">-->
                <!--</div>-->

            <!--</form>-->
        <!--</div>-->
    <!--</div>-->
<!--</div>-->
</section>
{% end %}

{% block js %}
{% include mode_js.html%}
<!-- Jquery DataTable Plugin Js -->
<script src="{{ static_url('assets/bundles/datatablescripts.bundle.js')}}"></script>
<script src="{{ static_url('assets/plugins/jquery-datatable/buttons/dataTables.buttons.min.js')}}"></script>
<script src="{{ static_url('assets/plugins/jquery-datatable/buttons/buttons.bootstrap4.min.js')}}"></script>
<script src="{{ static_url('assets/plugins/jquery-datatable/buttons/buttons.colVis.min.js')}}"></script>
<script src="{{ static_url('assets/plugins/jquery-datatable/buttons/buttons.html5.min.js')}}"></script>
<script src="{{ static_url('assets/plugins/jquery-datatable/buttons/buttons.print.min.js')}}"></script>
<script src="{{ static_url('assets/plugins/sweetalert/sweetalert2.min.js')}}"></script>

<script src="{{ static_url('assets/js/pages/tables/jquery-datatable.js')}}"></script>
<script src="{{ static_url('assets/plugins/nouislider/nouislider.js')}}"></script>
<script >
    $(document).ready(function(){
        loadData(9);
        Strategy_count();
    });

    function loadData() {
        var fx_flag = $("#fx_flag").val();
        //Range Example
        var myTable = $('#datatable01').DataTable({
            order: [[2, "desc"]],
            bProcessing: true, //DataTables载入数据时，是否显示‘进度’提示
            bServerSide: true, //是否启动服务器端数据导入
            searching: true,
            stateSave: false,
            ordering: false,
            paging: true,
            // pagingType: 'full_numbers',
            // sPaginationType: 'full_numbers',
            autoWidth: true,
            responsive: false,
            // pageLength: 10,
            destroy: false,
            lengthChange: false,
            iDisplayLength: 10, //默认显示的记录数
            bPaginate: true, //是否显示（应用）分页器
            bInfo: true, //是否显示页脚信息，DataTables插件左下角显示记录数
            ajax: {
                'url': '/admin/copy?fx_type=list_account&fx_flag=' + fx_flag + '&nt=' + Date.parse(new Date()),
                // 'dataSrc': handle_data_src,
                'type': 'POST',
                'async': false,
                'data': {}
            },
            columns: [
                {
                    title: '跟单账户',
                    data: 'account',
                    class: 'text-center align-middle'
                },
                {
                    title: '姓名',
                    data: 'allname',
                    class: 'text-center align-middle'
                },
                {
                    title: '授权状态',
                    data: 'follow_flag',
                    class: 'text-center align-middle',
                    render: function (data, type, row) {
                        if (row.follow_flag == 1) {
                            var e = '<button class="btn btn-primary btn-icon btn-icon-mini btn-round" onclick="edit_authorization(' + row.account + ',' + row.uaid + ',0);"> <i class="zmdi zmdi-cloud-done"></i></button>';
                        } else {
                            var e = '<button class="btn btn-slategray btn-icon btn-icon-mini btn-round" onclick="edit_authorization(' + row.account + ',' + row.uaid + ',1);"><i class="zmdi zmdi-cloud-off"></i></button>';
                        }
                        return e;
                    }
                },
                {
                    title: '跟单参数',
                    data: 'uaid',
                    class: 'text-center align-middle',
                    render: function (data, type, row) {
                        return "<button class=\"btn btn-primary btn-icon btn-icon-mini btn-round\" data-type=\"ajax-loader\" onclick=\"edit_parameter(" + row.account + "," + row.uaid + ");\"><i class=\"zmdi zmdi-settings\"></i></button>";
                    }
                }
                //   formatter:function(value,row,index){
                // var e = '<a href="#" mce_href="#" onclick="edit(\''+ row.news_id + '\')">编辑</a> ';
                // var d = '<a href="#" mce_href="#" onclick="del(\''+ row.inews_id +'\')">删除</a> ';
                //     return e+d;
            ],
            language: { //自定义描述....
                "sProcessing": "正在获取数据, 请稍后...",
                // "sLengthMenu": "显示 _MEUN_ 条",
                "sZeroRecords": "没有找到数据",
                "sInfo": "从 _START_ 到 _END_ 条记录 总记录数为 _TOTAL_ 条",
                "sInfoEmpty": "记录数为0",
                "sInfoFiltered": "(全部记录数 _MAX_ 条)",
                "sInfoPostFix": "",
                "sSearch": "全局搜索",
                "sUry": "",
                "oPaginate": {
                    "sFirst": "第一页",
                    "sPrevious": "上一页",
                    "sNext": "下一页",
                    "sLast": "最后一页"
                },
                "loadingRecords": "Please wait - loading...",
                "processing": "DataTables is currently busy",
                "search": "Apply filter _INPUT_ to table"
            },
        });
        // 延迟搜索
        $(".dataTables_filter input") .unbind() .bind('keyup change', function(e) { if (e.keyCode == 13 || this.value == "") { myTable .search(this.value) .draw(); } });

    }

    function Strategy_count() {
    // 跟单用户统计
        $.ajax({
            type: 'get',
            url: '/admin/strategy?fx_type=master_max_num',
            data: $("form").serialize(),
            cache: false,
            dataType: "JSON",
            success:  function(re) {
                if (re.reponse_status == 5) {
                    document.getElementById("list_master_count_ok").innerHTML = re.master_count_ok.toString();
                    document.getElementById("list_master_max_num").innerHTML = re.master_max_num.toString();
                }else if (re.reponse_status == -1){
                    login_time_out();
                }
                else {
                    $("#StrategyList").text("暂无策略账号");
                    $("#StrategyList").addClass("text-center");
                }
            },
            error:function(re) {
                showNotification("bg-red","跟单用户统计获取异常，稍后重试","bottom","center",null,null);//错误警示
            }
        });
    }


</script>

{% end %}

